{"remainingRequest":"C:\\Users\\ME\\Documents\\vue_project_20210407\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\ME\\Documents\\vue_project_20210407\\src\\views\\AdminCoupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\ME\\Documents\\vue_project_20210407\\src\\views\\AdminCoupons.vue","mtime":1621515115678},{"path":"C:\\Users\\ME\\Documents\\vue_project_20210407\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\ME\\Documents\\vue_project_20210407\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\ME\\Documents\\vue_project_20210407\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport $ from \"jquery\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      coupons: [],\r\n      isNew: false,\r\n      tempCoupon: {\r\n        title: \"\",\r\n        is_enabled: 0,\r\n        percent: 100,\r\n        due_date: 0,\r\n        code: \"\",\r\n      },\r\n      due_date: new Date(), //預設值為當前時間\r\n      //此項用來改變 modal title\r\n      addOrUpdate: \"\",\r\n      pagination: {},\r\n    };\r\n  },\r\n  watch: {\r\n    due_date() {\r\n      const vm = this;\r\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000);\r\n      vm.tempCoupon.due_date = timestamp;\r\n    },\r\n  },\r\n  methods: {\r\n    getCoupon(page = 1) {\r\n      const vm = this;\r\n      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons?page=${page}`;\r\n      vm.$store.dispatch(\"updateLoading\", true);\r\n      this.$http.get(url).then((response) => {\r\n        // console.log(\"getCoupon\", response.data);\r\n        vm.coupons = response.data.coupons;\r\n          vm.$store.dispatch(\"updateLoading\", false);\r\n      });\r\n    },\r\n    openCouponModal(isNew, item, isDel) {\r\n      const vm = this;\r\n      if (isDel) {\r\n        $(\"#delModal\").modal(\"show\");\r\n      } else {\r\n        $(\"#couponModal\").modal(\"show\");\r\n      }\r\n\r\n      if (isNew) {\r\n        //add\r\n        vm.tempCoupon = {};\r\n        vm.isNew = true;\r\n        vm.addOrUpdate = \"新增\";\r\n        const timestamp = Math.floor(new Date() / 1000);\r\n        const dateAndTime = new Date(timestamp * 1000).toISOString().split(\"T\");\r\n        vm.due_date = dateAndTime[0];\r\n      } else {\r\n        vm.tempCoupon = Object.assign({}, item);\r\n        vm.isNew = false;\r\n        if (!isDel) {\r\n          //update\r\n          vm.addOrUpdate = \"更新\";\r\n          const dateAndTime = new Date(vm.tempCoupon.due_date * 1000)\r\n            .toISOString()\r\n            .split(\"T\");\r\n          vm.due_date = dateAndTime[0];\r\n        }\r\n        // console.log(\"werwe\", vm.tempCoupon.due_date + \"-----\" + dateAndTime[0]); //2021-03-29\r\n      }\r\n    },\r\n    updateCoupon() {\r\n      let api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`;\r\n      const vm = this;\r\n      let httpMethod = \"post\";\r\n      //判斷要執行 add還是update api\r\n      if (!vm.isNew) {\r\n        //為update時\r\n        api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\r\n        httpMethod = \"put\";\r\n      }\r\n      vm.$store.dispatch(\"updateLoading\", true);\r\n      //因為資料上送時是以物件形式，故 vm.tempCoupon 資料要用物件包起來\r\n      this.$http[httpMethod](api, { data: vm.tempCoupon }).then((response) => {\r\n        // console.log(\"updateCoupon\", response.data);\r\n        if (response.data.success) {\r\n          vm.getCoupon();\r\n        } else {\r\n          this.$bus.$emit(\"message:push\", response.data.message, \"danger\");\r\n        }\r\n        vm.$store.dispatch(\"updateLoading\", false);\r\n        $(\"#couponModal\").modal(\"hide\");\r\n      });\r\n    },\r\n    delCoupon() {\r\n      const vm = this;\r\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\r\n      vm.$store.dispatch(\"updateLoading\", true);\r\n      this.$http.delete(api, { data: vm.tempCoupon }).then((response) => {\r\n        // console.log(\"delCoupon\", response.data);\r\n        vm.$store.dispatch(\"updateLoading\", false);\r\n        $(\"#delModal\").modal(\"hide\");\r\n        if (response.data.success) {\r\n          vm.getCoupon();\r\n        } else {\r\n          this.$bus.$emit(\"message:push\", response.data.message, \"danger\");\r\n        }\r\n      });\r\n    },\r\n  },\r\n  created() {\r\n    this.getCoupon();\r\n  },\r\n};\r\n",{"version":3,"sources":["AdminCoupons.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgMA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AdminCoupons.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"mt-4\">\r\n    <div class=\"text-right\">\r\n      <button\r\n        class=\"btn btn-primary\"\r\n        @click=\"openCouponModal(true, '', false)\"\r\n      >\r\n        建立新的優惠券\r\n      </button>\r\n    </div>\r\n    <table class=\"table mt-4\">\r\n      <thead>\r\n        <tr>\r\n          <th>名稱</th>\r\n          <th>折扣百分比</th>\r\n          <th>到期日</th>\r\n          <th>是否啟用</th>\r\n          <th>編輯</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr v-for=\"(item, key) in coupons\" :key=\"key\">\r\n          <td>{{ item.title }}</td>\r\n          <td>{{ item.percent }}%</td>\r\n          <td>{{ item.due_date | date }}</td>\r\n          <td>\r\n            <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\r\n            <span v-else class=\"text-muted\">未啟用</span>\r\n          </td>\r\n          <td>\r\n            <div class=\"btn-group\" role=\"group\">\r\n              <button\r\n                class=\"btn btn-outline-primary btn-sm\"\r\n                @click=\"openCouponModal(false, item, false)\"\r\n              >\r\n                編輯\r\n              </button>\r\n              <button\r\n                class=\"btn btn-outline-danger btn-sm\"\r\n                @click=\"openCouponModal(false, item, true)\"\r\n              >\r\n                刪除\r\n              </button>\r\n            </div>\r\n            <!---->\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <!--delete modal start-->\r\n    <div\r\n      class=\"modal fade\"\r\n      id=\"delModal\"\r\n      tabindex=\"-1\"\r\n      role=\"dialog\"\r\n      aria-labelledby=\"delModalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog\" role=\"document\">\r\n        <div class=\"modal-content border-0\">\r\n          <div class=\"modal-header bg-danger text-white\">\r\n            <h5 class=\"modal-title\" id=\"delModalLabel\">\r\n              <span>刪除優惠券</span>\r\n            </h5>\r\n            <button\r\n              type=\"button\"\r\n              class=\"close\"\r\n              data-dismiss=\"modal\"\r\n              aria-label=\"Close\"\r\n            >\r\n              <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            是否刪除\r\n            <strong class=\"text-danger\">{{ tempCoupon.title }}</strong>\r\n            優惠券(刪除後將無法恢復)。\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-outline-secondary\"\r\n              data-dismiss=\"modal\"\r\n            >\r\n              取消\r\n            </button>\r\n            <button type=\"button\" class=\"btn btn-danger\" @click=\"delCoupon\">\r\n              確認刪除\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!--delete modal end-->\r\n    <div\r\n      class=\"modal fade\"\r\n      id=\"couponModal\"\r\n      tabindex=\"-1\"\r\n      role=\"dialog\"\r\n      aria-labelledby=\"exampleModalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog\" role=\"document\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header bg-dark \">\r\n            <h5 class=\"modal-title text-white\" id=\"exampleModalLabel\">\r\n              {{ addOrUpdate }}優惠券\r\n            </h5>\r\n            <button\r\n              type=\"button\"\r\n              class=\"close\"\r\n              data-dismiss=\"modal\"\r\n              aria-label=\"Close\"\r\n            >\r\n              <span aria-hidden=\"true\" class=\"text-white\">&times;</span>\r\n            </button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <div class=\"form-group\">\r\n              <label for=\"title\">標題</label>\r\n              <input\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"title\"\r\n                v-model=\"tempCoupon.title\"\r\n                placeholder=\"請輸入標題\"\r\n              />\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"coupon_code\">優惠碼</label>\r\n              <input\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"coupon_code\"\r\n                v-model=\"tempCoupon.code\"\r\n                placeholder=\"請輸入優惠碼\"\r\n              />\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"due_date\">到期日</label>\r\n              <input\r\n                type=\"date\"\r\n                class=\"form-control\"\r\n                id=\"due_date\"\r\n                v-model=\"due_date\"\r\n              />\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"price\">折扣百分比</label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"form-control\"\r\n                id=\"price\"\r\n                v-model=\"tempCoupon.percent\"\r\n                placeholder=\"請輸入折扣百分比\"\r\n              />\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <div class=\"form-check\">\r\n                <input\r\n                  class=\"form-check-input\"\r\n                  type=\"checkbox\"\r\n                  :true-value=\"1\"\r\n                  :false-value=\"0\"\r\n                  v-model=\"tempCoupon.is_enabled\"\r\n                  id=\"is_enabled\"\r\n                />\r\n                <label class=\"form-check-label\" for=\"is_enabled\">\r\n                  是否啟用\r\n                </label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-secondary\"\r\n              data-dismiss=\"modal\"\r\n            >\r\n              Close\r\n            </button>\r\n            <button type=\"button\" class=\"btn btn-primary\" @click=\"updateCoupon\">\r\n              {{ addOrUpdate }}優惠券\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport $ from \"jquery\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      coupons: [],\r\n      isNew: false,\r\n      tempCoupon: {\r\n        title: \"\",\r\n        is_enabled: 0,\r\n        percent: 100,\r\n        due_date: 0,\r\n        code: \"\",\r\n      },\r\n      due_date: new Date(), //預設值為當前時間\r\n      //此項用來改變 modal title\r\n      addOrUpdate: \"\",\r\n      pagination: {},\r\n    };\r\n  },\r\n  watch: {\r\n    due_date() {\r\n      const vm = this;\r\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000);\r\n      vm.tempCoupon.due_date = timestamp;\r\n    },\r\n  },\r\n  methods: {\r\n    getCoupon(page = 1) {\r\n      const vm = this;\r\n      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons?page=${page}`;\r\n      vm.$store.dispatch(\"updateLoading\", true);\r\n      this.$http.get(url).then((response) => {\r\n        // console.log(\"getCoupon\", response.data);\r\n        vm.coupons = response.data.coupons;\r\n          vm.$store.dispatch(\"updateLoading\", false);\r\n      });\r\n    },\r\n    openCouponModal(isNew, item, isDel) {\r\n      const vm = this;\r\n      if (isDel) {\r\n        $(\"#delModal\").modal(\"show\");\r\n      } else {\r\n        $(\"#couponModal\").modal(\"show\");\r\n      }\r\n\r\n      if (isNew) {\r\n        //add\r\n        vm.tempCoupon = {};\r\n        vm.isNew = true;\r\n        vm.addOrUpdate = \"新增\";\r\n        const timestamp = Math.floor(new Date() / 1000);\r\n        const dateAndTime = new Date(timestamp * 1000).toISOString().split(\"T\");\r\n        vm.due_date = dateAndTime[0];\r\n      } else {\r\n        vm.tempCoupon = Object.assign({}, item);\r\n        vm.isNew = false;\r\n        if (!isDel) {\r\n          //update\r\n          vm.addOrUpdate = \"更新\";\r\n          const dateAndTime = new Date(vm.tempCoupon.due_date * 1000)\r\n            .toISOString()\r\n            .split(\"T\");\r\n          vm.due_date = dateAndTime[0];\r\n        }\r\n        // console.log(\"werwe\", vm.tempCoupon.due_date + \"-----\" + dateAndTime[0]); //2021-03-29\r\n      }\r\n    },\r\n    updateCoupon() {\r\n      let api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`;\r\n      const vm = this;\r\n      let httpMethod = \"post\";\r\n      //判斷要執行 add還是update api\r\n      if (!vm.isNew) {\r\n        //為update時\r\n        api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\r\n        httpMethod = \"put\";\r\n      }\r\n      vm.$store.dispatch(\"updateLoading\", true);\r\n      //因為資料上送時是以物件形式，故 vm.tempCoupon 資料要用物件包起來\r\n      this.$http[httpMethod](api, { data: vm.tempCoupon }).then((response) => {\r\n        // console.log(\"updateCoupon\", response.data);\r\n        if (response.data.success) {\r\n          vm.getCoupon();\r\n        } else {\r\n          this.$bus.$emit(\"message:push\", response.data.message, \"danger\");\r\n        }\r\n        vm.$store.dispatch(\"updateLoading\", false);\r\n        $(\"#couponModal\").modal(\"hide\");\r\n      });\r\n    },\r\n    delCoupon() {\r\n      const vm = this;\r\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\r\n      vm.$store.dispatch(\"updateLoading\", true);\r\n      this.$http.delete(api, { data: vm.tempCoupon }).then((response) => {\r\n        // console.log(\"delCoupon\", response.data);\r\n        vm.$store.dispatch(\"updateLoading\", false);\r\n        $(\"#delModal\").modal(\"hide\");\r\n        if (response.data.success) {\r\n          vm.getCoupon();\r\n        } else {\r\n          this.$bus.$emit(\"message:push\", response.data.message, \"danger\");\r\n        }\r\n      });\r\n    },\r\n  },\r\n  created() {\r\n    this.getCoupon();\r\n  },\r\n};\r\n</script>\r\n"]}]}